# 组员 1 指导手册：数据库建模与图纸设计（ER/DFD）

## 1. 项目核心逻辑说明
本项目是一个基于 Serverless 架构的存算分离系统。请根据以下逻辑绘制图表：

### 实体与属性
1. **用户 (User)**: id, **姓名(唯一)**, 邮箱, 密码哈希, 角色, 状态, 存储配额, 已用空间, 所属组ID, 创建时间, **最后更新时间 (用于令牌指纹)**
2. **用户组 (Group)**: id, 组名, 描述, 默认存储配额, 最大用户数, 当前用户数
3. **文件/文件夹 (File)**: id, 名称, 大小(字节), MIME类型, 存储Key, 存储后端ID, 用户ID, 父目录ID(自关联), 路径, 类型(folder/pdf/image等), 星标, 下载量, **状态(活跃/违规下架)**, **创建时间**, **更新时间**
4. **分享记录 (Share)**: id, 文件ID, 用户ID, 提取码, 有效天数, 创建时间, 过期时间, 访问次数, 最大访问次数限制
5. **存储后端 (Backend)**: id, 名称, 类型(r2/s3/webdav等), 启用状态, 是否默认, 是否共享, 配置信息(JSON)
6. **用户私有后端 (UserBackend)**: id, 用户ID, 名称, 类型, 启用状态, 是否默认, 加密配置信息
7. **配额分配 (Allocation)**: id, 组ID, 存储后端ID, 分配配额(GB), 已使用量
8. **系统日志 (Log)**: id, 动作, 用户ID, 用户名, 状态(成功/失败), 详情, IP, 相关文件ID, 文件名, 记录时间 (包含上传者审计字段)

### 关系说明
*   **User - Group**: N:1 (每个用户属于一个组)
*   **User - File**: 1:N (用户拥有多个文件)
*   **File - File**: 1:N (**自关联属性**，即文件夹包含子项)
*   **File - Share**: 1:N (一个文件可生成多个提取码)
*   **File - Backend**: N:1 (文件存储在特定后端)
*   **User - UserBackend**: 1:N (用户可挂载多个私有后端)
*   **Group - Backend**: N:N (通过 Allocation 实现多对多分配关系)
*   **User - Log**: 1:N (系统审计追踪)

## 2. 给 AI 的指令（Prompt）
**请直接复制以下内容发给 AI：**
> "我是一个数据库设计师，正在做一个《分布式对象存储系统》的课程设计。
> 我的组长已经完成了核心开发，现在需要我根据他提供的逻辑完成 E-R 图和 DFD 图的设计。
> 
> **要求：**
> 1. 请根据我提供的【实体与属性】和【关系说明】，先帮我生成一份详细的 E-R 图描述，最好使用 Mermaid 语法绘制。注意 File 实体的自关联（parent_id）。
> 2. 请帮我设计系统的 DFD 数据流图。包括 0 层（顶层）图和 1 层图。加工过程应包含：身份认证、文件管理（上传/批量移动/删除）、分享管理、存储后端配置。
> 3. 请根据逻辑生成一份标准格式的【数据字典】表格，包含字段名、数据类型、约束和说明。
> 
> 【实体与属性及关系说明内容见上方】"

---
**组员 1 注意事项：**
*   AI 生成 Mermaid 代码后，你可以去 [Mermaid Live Editor](https://mermaid.live/) 粘贴并下载成图片。
*   确保 DFD 图里体现了数据流向 Cloudflare R2（外部存储）。

